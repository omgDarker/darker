<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<div th:fragment="resouce" role="tabpanel" class="tab-pane active" id="resource">
    <!-- 资源管理模块 -->
    <div class="check-div form-inline">
        <button class="btn btn-yellow btn-xs" data-toggle="modal" data-target="#addSource">添加资源</button>
    </div>
    <div class="data-div">
        <!-- 列名 -->
        <div class="row tableHeader">
            <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1 ">
                序号
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                资源名称
            </div>
            <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
                资源链接
            </div>
            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
                资源操作
            </div>
        </div>
        <!-- 数据 -->
        <div class="tablebody">
            <!--/*@thymesVar id="resourceList" type="java.util.List"*/-->
            <div class="row" th:each="resource : ${resourceList}">
                <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1 levl3 ">
                    <span th:text="${resource.id}"></span>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4  levl3">
                    <span class=""> &nbsp;</span>
                    <span th:text="${resource.name}"></span>
                </div>
                <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
                    <span th:text="${resource.path}"></span>
                </div>
                <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
                    <button class="btn btn-success btn-xs" data-toggle="modal" data-id="${resource.id}"
                            data-target="#updateResource"
                            th:onclick="'javascript:queryResource(\''+${resource.id}+'\');'">修改
                    </button>
                    <button class="btn btn-danger btn-xs" data-toggle="modal"
                            th:onclick="'javascript:deleteResource(\''+${resource.id}+'\');'">删除
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!--页码块-->
    <footer class="footer">
        <ul class="pagination">
            <li>
                <select>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>
                页
            </li>
            <li class="gray">
                共20页
            </li>
            <li>
                <i class="glyphicon glyphicon-menu-left">
                </i>
            </li>
            <li>
                <i class="glyphicon glyphicon-menu-right">
                </i>
            </li>
        </ul>
    </footer>
    <!--弹出窗口 添加资源-->
    <div class="modal fade" id="addSource" role="dialog" aria-labelledby="gridSystemModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <!-- 弹窗头 -->
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="gridSystemModalLabel">添加资源</h4>
                </div>
                <!-- 弹窗体 -->
                <div class="modal-body">
                    <div class="container-fluid">
                        <form class="form-horizontal" action="/resource/add" method="POST">
                            <div class="form-group ">
                                <label for="name" class="col-xs-3 control-label">资源名称：</label>
                                <div class="col-xs-8 ">
                                    <input type="text" class="form-control input-sm duiqi"
                                           name="name" placeholder="请输入资源名称">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="path" class="col-xs-3 control-label">资源链接：</label>
                                <div class="col-xs-8 ">
                                    <input type="text" class="form-control input-sm duiqi"
                                           name="path" placeholder="请输入资源链接">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="parentName" class="col-xs-3 control-label">父节点：</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control input-sm duiqi"
                                           name="parentName" placeholder="请输入父节点">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-xs-3 control-label">资源类型：</label>
                                <div class="col-xs-8">
                                    <label class="control-label" for="index">
                                        <input type="radio" name="classify" value="index">index</label>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    <label class="control-label" for="admin">
                                        <input type="radio" name="classify" value="admin">admin</label>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-xs btn-xs btn-green">保 存</button>
                                <button type="button" class="btn btn-xs btn-xs btn-white" data-dismiss="modal">取 消
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--弹出窗口 修改资源-->
    <div class="modal fade" id="updateSource" role="dialog" aria-labelledby="gridSystemModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="gridSystemModalLabel">修改资源</h4>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <form class="form-horizontal" action="/resource/update" method="POST">
                            <!-- form表单不支持put请求方式的解决方案 -->
                            <input type="hidden" name="_method" value="PUT"/>
                            <input type="hidden" id="id" name="id" value="">
                            <div class="form-group ">
                                <label for="name" class="col-xs-3 control-label">资源名称：</label>
                                <div class="col-xs-8 ">
                                    <input type="text" class="form-control input-sm duiqi" id="name"
                                           name="name" value="">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="path" class="col-xs-3 control-label">资源链接：</label>
                                <div class="col-xs-8 ">
                                    <input type="text" class="form-control input-sm duiqi" id="path"
                                           name="path" value="">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="parentName" class="col-xs-3 control-label">父节点：</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control input-sm duiqi" id="parentName"
                                           name="parentName" value="">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-xs-3 control-label">资源类型：</label>
                                <div class="col-xs-8">
                                    <label class="control-label" for="index">
                                        <input type="radio" name="classify" id="index" value="index">index</label>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    <label class="control-label" for="admin">
                                        <input type="radio" name="classify" id="admin" value="admin">admin</label>
                                </div>
                            </div>
                            <!-- 按钮 -->
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-xs btn-xs btn-green">保 存</button>
                                <button type="button" class="btn btn-xs btn-xs btn-white" data-dismiss="modal">取 消
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // 查询资源实体
        function queryResource(id) {
            $.ajax({
                //请求URL地址,controller的名称
                url: "/resource/all/" + id,
                //请求返回数据格式为json,还可以是text等
                dataType: "json",
                //请求是否为异步,默认是true
                async: true,
                //是否从浏览器缓存中加载数据信息
                cache: false,
                //设置请求超时时间
                timeout: 1000,
                //参数值,如果URL带参数,这里就可以不用写了
                data: {},
                //POST安全性高,数据量大;GET安全性低,数据量小,从浏览器获取数据
                type: "GET",
                //请求发出前的处理函数,参数(XMLHttpRequest对象,返回状态)
                beforeSend: function () {
                },
                //请求成功时的处理函数,参数(返回数据,返回状态)
                success: function (data) {
                    // 隐藏模态框
                    $("#updateSource").modal('hide');
                    // 返回实体类
                    $("#id").val(data.id);
                    $("#name").val(data.name);
                    $("#path").val(data.path);
                    $("#parentName").val(data.parentName);
                    // 资源选项
                    if (data.classify === 'admin') {
                        $("#admin").attr("checked", "checked");
                    } else if (data.classify === 'index') {
                        $("#index").attr("checked", "checked");
                    }
                    // 显示模态框
                    $("#updateSource").modal('show');
                },
                //请求完成时的处理函数,参数(XMLHttpRequest对象,返回状态)//无论成与败均调用
                complete: function () {
                },
                //请求出错时的处理函数,参数(XMLHttpRequest对象,返回状态,错误对象)
                error: function () {
                }
            });
        };

        // 删除操作
        function deleteResource(id) {
            swal({
                title: "操作提示",      //弹出框的title
                text: "确定删除吗？",   //弹出框里面的提示文本
                type: "warning",        //弹出框类型
                showCancelButton: true, //是否显示取消按钮
                confirmButtonColor: "#DD6B55",//确定按钮颜色
                cancelButtonText: "取消",//取消按钮文本
                confirmButtonText: "是的，确定删除！",//确定按钮上面的文档
                confirmButtonClass: 'btn btn-success',
                cancelButtonClass: 'btn btn-danger',
                buttonsStyling: false
            }).then(function (isConfirm) {
                $.ajax({
                    //请求URL地址,controller的名称
                    url: "/resource/delete/" + id,
                    //请求返回数据格式为json,还可以是text等
                    dataType: "json",
                    //请求是否为异步,默认是true
                    async: true,
                    //是否从浏览器缓存中加载数据信息
                    cache: false,
                    //设置请求超时时间
                    timeout: 1000,
                    //参数值,如果URL带参数,这里就可以不用写了
                    data: {},
                    //POST安全性高,数据量大;GET安全性低,数据量小,从浏览器获取数据
                    type: "DELETE",
                    //请求发出前的处理函数,参数(XMLHttpRequest对象,返回状态)
                    beforeSend: function () {
                    },
                    //请求成功时的处理函数,参数(返回数据,返回状态)
                    success: function (data) {
                        // 提示信息
                        swal("删除成功", "数据已被删除！", data.msg);
                        // 刷新页面
                        location.reload(true);
                        // window.location.reload();
                        // window.location.href = "/admin/home";
                    },
                    //请求完成时的处理函数,参数(XMLHttpRequest对象,返回状态)//无论成与败均调用
                    complete: function () {
                    },
                    //请求出错时的处理函数,参数(XMLHttpRequest对象,返回状态,错误对象)
                    error: function () {
                    }
                });
            }, function (dismiss) {
                // dismiss的值可以是'cancel', 'overlay','close', 'timer'
                if (dismiss === 'cancel') {
                    swal(
                        '已取消！',
                        '你的虚拟文件是安全的:)',
                        'error'
                    );
                }
            });
        };
    </script>
</div>

